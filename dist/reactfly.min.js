!function(t,e){"use strict";"function"==typeof define&&define.amd?define([],function(){return t.ReactFlyMixin=e()}):"object"==typeof exports?module.exports=e():t.ReactFlyMixin=e()}(this,function(){"use strict";function t(t,e){for(var i=0,s=t.length;i<s;++i)if(t[i][".key"]===e)return i;return-1}function e(t){throw new Error("ReactFly: "+t)}function i(t){var i;"string"!=typeof t?i="Bind variable must be a string. Got: "+t:0===t.length?i='Bind variable must be a non-empty string. Got: ""':t.length>768?i="Bind variable is too long to be stored in Flybase. Got: "+t:/[\[\].#$\/\u0000-\u001F\u007F]/.test(t)&&(i="Bind variable cannot contain any of the following characters: . # $ ] [ /. Got: "+t),"undefined"!=typeof i&&e(i)}function s(t,e){var i={};return"object"==typeof e&&null!==e?i=e:i[".value"]=e,i[".key"]=t,i}function n(t,e){this.data[t]=s(e.key(),e.value()),this.setState(this.data)}function a(t,e){var i=[];e.forEach(function(t){var e=s(t.key(),t.value());i.push(e)}.bind(this)),this.data[t]=i,this.setState(this.data)}function o(e,i,n){var a,o=this.data[e];if(null===n)a=0;else{var f=t(o,n);a=f+1}var r=s(i.key(),i.value());o.splice(a,0,r),this.setState(this.data)}function f(e,i){var s=this.data[e],n=t(s,i.key());s.splice(n,1),this.setState(this.data)}function r(e,i){var n=this.data[e],a=t(n,i.key());n[a]=s(i.key(),i.value()),this.setState(this.data)}function d(t,s,d,h){"[object Object]"!==Object.prototype.toString.call(t)&&e("Invalid Flybase reference"),i(s),"undefined"!=typeof this.flybaseRefs?"undefined"!=typeof this.flybaseRefs[s]&&e("this.state."+s+" is already bound to a Flybase reference"):(this.flybaseRefs=[],this.flybaseListeners=[]),this.flybaseRefs[s]=t,h?("undefined"==typeof this.data&&(this.data=[]),this.data[s]=[],this.setState(this.data),this.flybaseListeners[s]={value:t.on("value",a.bind(this,s),d),added:t.on("added",o.bind(this,s),d),removed:t.on("removed",f.bind(this,s),d),changed:t.on("changed",r.bind(this,s),d)}):this.flybaseListeners[s]={value:t.on("value",n.bind(this,s),d)}}var h={componentWillUnmount:function(){for(var t in this.flybaseRefs)this.flybaseRefs.hasOwnProperty(t)&&this.unbind(t)},bindAsArray:function(t,e,i){var s=d.bind(this);s(t,e,i,!0)},bindAsObject:function(t,e,i){var s=d.bind(this);s(t,e,i,!1)},unbind:function(t,s){i(t),"undefined"==typeof this.flybaseRefs[t]&&e("this.state."+t+" is not bound to a Flybase reference");for(var n in this.flybaseListeners[t])if(this.flybaseListeners[t].hasOwnProperty(n)){var a=this.flybaseListeners[t][n];this.flybaseRefs[t].off(n,a)}delete this.flybaseRefs[t],delete this.flybaseListeners[t];var o={};o[t]=void 0,this.setState(o,s)}};return h});